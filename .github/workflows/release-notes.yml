name: Release Notes

on:
  push:
    branches:
    - main
  workflow_dispatch:

jobs:
  release-notes:
    runs-on: windows-latest
    steps:
    - name: Git - Checkout
      uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: GitVersion - Install
      uses: gittools/actions/gitversion/setup@v0.9.9
      with:
        versionSpec: '5.x'

    - name: GitVersion - Execute
      id: gitversion
      uses: gittools/actions/gitversion/execute@v0.9.9
      with:
        useConfigFile: true
        additionalArguments: '/updateprojectfiles'

    - name: Environment - Build Number
      uses: myci-actions/export-env-var@1
      with:
        name: BUILD_NUMBER
        value: ${{ steps.gitversion.outputs.fullSemVer }}

    - name: Main Release - Notes
      uses: release-drafter/release-drafter@v5
      env:
        GITHUB_TOKEN: ${{ github.token }}
      with:
        name: 'Release v${{ steps.gitversion.outputs.majorMinorPatch }}.${{ steps.gitversion.outputs.buildMetaData }}'
        tag: 'v${{ steps.gitversion.outputs.majorMinorPatch }}.${{ steps.gitversion.outputs.buildMetaData }}'
        version: 'v${{ steps.gitversion.outputs.majorMinorPatch }}.${{ steps.gitversion.outputs.buildMetaData }}'
        publish: false
        prerelease: false
