@using Sidekick.Common.Blazor.Layouts;

<SidekickErrorBoundary @ref="Boundary">
    <ChildContent>
        @ChildContent
    </ChildContent>
    <ErrorContent />
</SidekickErrorBoundary>

@inject IJSRuntime JSRuntime;
@inject ILogger<SilentErrorBoundary> Logger;
@code {
    /// <summary>
    /// Gets or sets the content of the wrapper.
    /// </summary>
    [Parameter]
    public RenderFragment ChildContent { get; set; } = null!;

    private SidekickErrorBoundary? Boundary { get; set; }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (Boundary?.CurrentException != null)
        {
            await JSRuntime.InvokeVoidAsync("console.error", Boundary.CurrentException.ToString());
            Logger.LogError(Boundary.CurrentException, "An error occured while executing a component.");
        }

        await base.OnAfterRenderAsync(firstRender);
    }
}
