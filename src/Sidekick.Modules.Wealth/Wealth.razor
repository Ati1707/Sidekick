@page "/wealth"
@inherits SidekickView
@using Sidekick.Common.Errors;
@using Sidekick.Modules.Wealth.Components

<MudGrid Spacing="0">
    <MudItem xs="8">
        <WealthOverTime />
        <WealthInventory />
        @if (WealthParser.IsRunning())
        {
            <MudAlert Dense="true" Style="width: 205px;" Variant="Variant.Filled" Severity="Severity.Success">Parser Running</MudAlert>
        }
        else
        {
            <MudAlert Dense="true" Style="width: 205px;" Variant="Variant.Filled" Severity="Severity.Error">Parser Stopped</MudAlert>
        }
    </MudItem>
    <MudItem xs="4">
        <MudPaper Class="flex-none d-flex py-8" Elevation="0" Width="270px" Height="1px;">
            <MudCard Width="100%" Height="800px">
                <MudCardContent Style="height: 100%;">
                    <WealthDistribution />
                    <WealthParserLogs />
                </MudCardContent>
                <MudCardActions>
                    <MudButton Variant="Variant.Filled" Class="pr-5" Style="margin-left:100px;" Color="Color.Primary" OnClick="Start">Start</MudButton>
                    <MudButton Variant="Variant.Filled" Class="pr-5" Style="margin-left:10px;" Color="Color.Primary" OnClick="Stop">Stop</MudButton>
                </MudCardActions>
            </MudCard>
        </MudPaper>
    </MudItem>
</MudGrid>

@inject WealthParser WealthParser
@inject ISettings Settings
@inject NavigationManager NavigationManager
@code {
    public override string Title => "Wealth Tracker";

    public override int ViewWidth => 1280;

    public override int ViewHeight => 800;

    protected override void OnInitialized()
    {
        if (!Settings.Enable_WealthTracker)
        {
            NavigationManager.NavigateTo(ErrorType.DisabledModule.ToUrl("wealth"));
        }

        base.OnInitialized();
    }

    private void Start()
    {
        WealthParser.Start();
    }

    private void Stop()
    {
        WealthParser.Stop();
    }
}
