@using Sidekick.Apis.Poe.Bulk;

@if (!string.IsNullOrEmpty(QueryId))
{
    <MudTooltip Text="@Resources.OpenQueryInWebsite"
                Placement="Placement.Left">
        <MudIconButton Icon="@Icons.Material.Filled.OpenInBrowser"
                       OnClick="OpenWebsite" />
    </MudTooltip>
}

@inject TradeResources Resources
@inject ITradeSearchService TradeSearchService
@inject IBulkTradeService BulkTradeService
@inject IBrowserProvider BrowserProvider

@code {

    [CascadingParameter]
    public required Item Item { get; set; }

    [Parameter]
    public string? QueryId { get; set; }

    [Parameter]
    public TradeMode Mode { get; set; }

    private async Task OpenWebsite()
    {
        if (QueryId == null)
        {
            return;
        }

        if (Mode == TradeMode.Bulk)
        {
            var uri = await BulkTradeService.GetTradeUri(Item, QueryId);
            BrowserProvider.OpenUri(uri);
        }
        else
        {
            var uri = await TradeSearchService.GetTradeUri(QueryId);
            BrowserProvider.OpenUri(uri);
        }
    }
}
