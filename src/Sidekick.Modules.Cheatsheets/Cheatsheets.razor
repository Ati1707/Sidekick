@page "/cheatsheets"
@page "/cheatsheets/{wikiPage}"
@layout CheatsheetLayout
@inherits SidekickView

@if (!string.IsNullOrEmpty(IFrameSrc))
{
    <iframe src="@IFrameSrc" style="height: 100%;"></iframe>
}

@code {
    [Inject]
    private CheatsheetResources Resources { get; set; }

    [Inject]
    private ISettings Settings { get; set; }

    [Inject]
    private NavigationManager NavigationManager { get; set; }

    [Parameter]
    public string WikiPage { get; set; }

    private string IFrameSrc { get; set; }

    public override string Title => Resources.Cheatsheets;

    public override int ViewWidth => 1280;

    public override int ViewHeight => 800;

    protected override void OnParametersSet()
    {
        var page = WikiPage.DecodeBase64Url();
        if (string.IsNullOrEmpty(page))
        {
            page = Settings.Cheatsheets_Selected;
        }

        if (!string.IsNullOrEmpty(page) && Settings.Cheatsheets_WikiPages.TryGetValue(page, out var wikiPage))
        {
            IFrameSrc = wikiPage;
        }
        else
        {
            NavigationManager.NavigateTo($"/cheatsheets/{Settings.Cheatsheets_WikiPages.First().Key.EncodeBase64Url()}");
        }

        base.OnParametersSet();
    }
}
